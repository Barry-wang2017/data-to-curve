import os
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from scipy import interpolate

def process_csv_files(directory, start_row, start_col, x_col, y_col, x_range, y_range, num_points, img_resolution):
    # Get all CSV files in the directory
    csv_files = [f for f in os.listdir(directory) if f.endswith('.csv')]
    
    plt.figure(figsize=(10, 6))
    
    for file in csv_files:
        # Read CSV file
        df = pd.read_csv(os.path.join(directory, file), skiprows=start_row-1, usecols=range(start_col-1, df.shape[1]))
        
        # Extract x and y data
        x = df.iloc[:, x_col-start_col].astype(float)
        y = df.iloc[:, y_col-start_col].astype(float)
        
        # Interpolate data
        f = interpolate.interp1d(x, y)
        x_new = np.linspace(x.min(), x.max(), num_points)
        y_new = f(x_new)
        
        # Plot data
        plt.plot(x_new, y_new, label=file)
    
    plt.xlabel(f'Column {x_col}')
    plt.ylabel(f'Column {y_col}')
    plt.title('Data from CSV files')
    plt.legend()
    
    # Set x and y range if provided
    if x_range:
        plt.xlim(x_range)
    if y_range:
        plt.ylim(y_range)
    
    # Save plot
    plt.savefig(os.path.join(directory, 'output_plot.png'), dpi=img_resolution[0], figsize=(img_resolution[1]/img_resolution[0], img_resolution[2]/img_resolution[0]))
    plt.close()

# Example usage
directory = 'path/to/your/csv/files'
start_row = 2  # Start processing from the second row
start_col = 3  # Start processing from the third column
x_col = 4  # Use the fourth column as x-axis
y_col = 5  # Use the fifth column as y-axis
x_range = (0, 100)  # Set x-axis range (min, max)
y_range = (0, 1000)  # Set y-axis range (min, max)
num_points = 1000  # Number of points for interpolation
img_resolution = (300, 1920, 1080)  # DPI, width, height

process_csv_files(directory, start_row, start_col, x_col, y_col, x_range, y_range, num_points, img_resolution)
